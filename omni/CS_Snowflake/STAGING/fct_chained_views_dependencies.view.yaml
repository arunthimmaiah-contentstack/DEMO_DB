# Reference this view as staging__fct_chained_views_dependencies
#This description was pulled from dbt.
description: |
  This returns models dependent on chains of "non-physically-materialized" models (views and ephemerals), highlighting potential cases for improving performance by switching the materialization of model(s) within  the chain to table or incremental. 

schema: STAGING
table_name: FCT_CHAINED_VIEWS_DEPENDENCIES

dimensions:
  parent:
    sql: '"PARENT"'

  child:
    sql: '"CHILD"'

  distance:
    sql: '"DISTANCE"'

  path:
    sql: '"PATH"'

measures:
  count:
    aggregate_type: count

#The info below was pulled from your dbt repository and is read-only.
dbt:
  name: fct_chained_views_dependencies
  target_schema: STAGING
  description: |
    This returns models dependent on chains of "non-physically-materialized" models (views and ephemerals), highlighting potential cases for improving performance by switching the materialization of model(s) within  the chain to table or incremental. 
  config:
    materialized: view
  code: |-
    with all_relationships as (
        select  
            *
        from {{ ref('int_all_dag_relationships') }}
        where distance <> 0
        and not parent_is_excluded
        and not child_is_excluded
    ),

    final as (
        select
            parent,
            child, -- the model with potentially long run time / compilation time, improve performance by breaking the upstream chain of views
            distance,
            path
        from all_relationships
        where is_dependent_on_chain_of_views
        and child_resource_type = 'model'
        and distance > {{ var('chained_views_threshold') }}
    )

    select * from final

    {{ filter_exceptions() }}

    order by distance desc
