# Reference this view as staging__fct_staging_dependent_on_staging
#This description was pulled from dbt.
description: This table shows each parent/child relationship where models in the
  staging layer are dependent on each other.

schema: STAGING
table_name: FCT_STAGING_DEPENDENT_ON_STAGING

dimensions:
  parent:
    sql: '"PARENT"'

  parent_model_type:
    sql: '"PARENT_MODEL_TYPE"'

  child:
    sql: '"CHILD"'

  child_model_type:
    sql: '"CHILD_MODEL_TYPE"'

measures:
  count:
    aggregate_type: count

#The info below was pulled from your dbt repository and is read-only.
dbt:
  name: fct_staging_dependent_on_staging
  target_schema: STAGING
  description: This table shows each parent/child relationship where models in the
    staging layer are dependent on each other.
  config:
    materialized: table
  code: |-
    -- check for cases where models in the staging layer are dependent on each other
    with direct_model_relationships as (
        select  
            *
        from {{ ref('int_all_dag_relationships') }}
        where parent_resource_type in ('model', 'snapshot')
        and child_resource_type in ('model', 'snapshot')
        and not parent_is_excluded
        and not child_is_excluded
        and distance = 1
    ),

    bending_connections as (
        select
            parent,
            parent_model_type,
            child,
            child_model_type
        from direct_model_relationships
        where parent_model_type = 'staging'
        and child_model_type = 'staging'
    )

    select * from bending_connections

    {{ filter_exceptions() }}
