# Reference this view as omni_dbt_marts__mql_volume
schema_label: ""

schema: omni_dbt_marts
table_name: MQL_VOLUME

dimensions:
  metric_name:
    sql: '"METRIC_NAME"'

  object:
    sql: '"OBJECT"'

  id:
    sql: '"ID"'
    format: ID
    primary_key: true

  product:
    sql: '"PRODUCT"'

  customer_designation:
    sql: '"CUSTOMER_DESIGNATION"'

  product_deal_percentage:
    sql: '"PRODUCT_DEAL_PERCENTAGE"'

  metric_date_1:
    sql: '"METRIC_DATE_1"'

  metric_date_2:
    sql: '"METRIC_DATE_2"'

  metric_measure_1:
    sql: '"METRIC_MEASURE_1"'

  metric_measure_2:
    sql: '"METRIC_MEASURE_2"'

  metric_measure_3:
    sql: '"METRIC_MEASURE_3"'

  geo_c:
    sql: '"GEO_C"'

  region:
    sql: '"REGION"'

  sub_region:
    sql: '"SUB_REGION"'

  revenue:
    sql: '"REVENUE"'

  company_size:
    sql: '"COMPANY_SIZE"'

  record_type:
    sql: '"RECORD_TYPE"'

  leadsource:
    sql: '"LEADSOURCE"'

  motion:
    sql: '"MOTION"'

  sub_motion:
    sql: '"SUB_MOTION"'

  opp_type:
    sql: '"OPP_TYPE"'

  account_name:
    sql: '"ACCOUNT_NAME"'

  matched_account_tier_ld:
    sql: '"MATCHED_ACCOUNT_TIER_LD"'

  account_tier:
    sql: '"ACCOUNT_TIER"'

  deployment_status_c:
    sql: '"DEPLOYMENT_STATUS_C"'

  type:
    sql: '"TYPE"'

  sync_date:
    sql: '"SYNC_DATE"'

  sales_motion:
    sql: '"SALES_MOTION"'

  expansion_sales_motion:
    sql: '"EXPANSION_SALES_MOTION"'

  demand_bucket:
    sql: '"DEMAND_BUCKET"'

measures:
  count:
    aggregate_type: count

#The info below was pulled from your dbt repository and is read-only.
dbt:
  name: mql_volume
  target_schema: STAGING
  config:
    schema: marts
    materialized: table
  code: |-
    SELECT
      'MQL Volume' AS METRIC_NAME,
      'Lead' AS OBJECT,
      NULL AS ID,
      NULL AS PRODUCT,
      NULL AS CUSTOMER_DESIGNATION,
      NULL AS PRODUCT_DEAL_PERCENTAGE,
      CONVERT_TIMEZONE('UTC', 'America/Los_Angeles', STAGE_DATE_MQL_V_2_C::TIMESTAMP_NTZ) AS METRIC_DATE_1,
      NULL AS METRIC_DATE_2,
      LEAD_INFO.ID AS METRIC_MEASURE_1, -- FOR VARIABLE CHARACTER
      NULL AS METRIC_MEASURE_2, -- FOR NUMBERS
      NULL AS METRIC_MEASURE_3,
      GEO_C AS GEO_C,
      NULL AS REGION,
      NULL AS SUB_REGION,
      ANNUAL_REVENUE_C AS REVENUE,
      CASE
            WHEN CUSTOMER_SEGMENT_C = 'Enterprise Customer' THEN 'Revenue > $1B'
            WHEN CUSTOMER_SEGMENT_C = 'MM Customer' THEN 'Revenue < $1B'
            ELSE CUSTOMER_SEGMENT_C
        END COMPANY_SIZE,
      NULL AS RECORD_TYPE,
      LEAD_SOURCES.LEAD_SOURCE AS LEADSOURCE,
      CASE 
        WHEN LEAD_SOURCE_CATEGORY_C IN ('Sales', 'Marketing') THEN 'GTM'
        WHEN LEAD_SOURCE_CATEGORY_C IN ('Partner') THEN 'Partner'
        WHEN LEAD_SOURCE_CATEGORY_C IN ('Customer') THEN 'Expansion'
        ELSE NULL
      END AS MOTION,
      LEAD_SOURCES.LEAD_SOURCE_CATEGORY_C AS SUB_MOTION,
      NULL AS OPP_TYPE,
      COMPANY AS ACCOUNT_NAME,
      MATCHED_ACCOUNT_NAME_C AS MATCHED_ACCOUNT_TIER_LD,
      MATCHED_ACCOUNT_TIER_LD_C AS ACCOUNT_TIER,
      NULL AS DEPLOYMENT_STATUS_C,
      NULL AS TYPE,
      CONVERT_TIMEZONE('UTC', 'America/Los_Angeles', LEAD_INFO._FIVETRAN_SYNCED::TIMESTAMP_NTZ) AS SYNC_DATE,
      NULL AS SALES_MOTION, --THIS IS A NEW FIELD ADDED IN ASC (OBI-1404 & 1405)
      NULL AS EXPANSION_SALES_MOTION, --THIS IS A NEW FIELD ADDED IN ASC (OBI-1404 & 1405)
      NULL AS DEMAND_BUCKET
    FROM {{ref('stg_salesforce__leads_info')}} AS LEAD_INFO
    LEFT JOIN {{ref('stg_salesforce__leads_stages')}} AS LEAD_STAGES
        ON LEAD_INFO.ID = LEAD_STAGES.ID
    LEFT JOIN {{ref('stg_salesforce__leads_source')}} AS LEAD_SOURCES
        ON LEAD_INFO.ID = LEAD_SOURCES.ID
    LEFT JOIN {{ref('stg_salesforce__leads_contact')}} AS LEAD_CONTACTS
        ON LEAD_INFO.ID = LEAD_CONTACTS.ID
    WHERE 1=1
    AND LEAD_INFO.IS_DELETED = 'FALSE'
    AND (LEAD_SOURCES.LEAD_SOURCE NOT LIKE ('In Product Contentstack') OR LEAD_SOURCES.LEAD_SOURCE IS NULL)
    AND (LEAD_CONTACTS.EMAIL NOT LIKE ('%contentstack%') OR LEAD_CONTACTS.EMAIL IS NULL)
    AND (CONTACT_US_SUBJECT_C NOT IN ('Free Trial') OR CONTACT_US_SUBJECT_C IS NULL)
    AND (STATUS NOT IN ('Customer','Partner') OR STATUS IS NULL)
