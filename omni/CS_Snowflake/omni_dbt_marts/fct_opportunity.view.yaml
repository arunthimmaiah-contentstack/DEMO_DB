# Reference this view as omni_dbt_marts__fct_opportunity
schema_label: ""

schema: omni_dbt_marts
table_name: FCT_OPPORTUNITY

dimensions:
  opportunity_id:
    sql: '"OPPORTUNITY_ID"'
    format: ID

  opportunity_name:
    sql: '"OPPORTUNITY_NAME"'

  account_id:
    sql: '"ACCOUNT_ID"'
    format: ID

  opportunity_stage_name:
    sql: '"OPPORTUNITY_STAGE_NAME"'

  amount:
    sql: '"AMOUNT"'

  probability:
    sql: '"PROBABILITY"'

  opportunity_type:
    sql: '"OPPORTUNITY_TYPE"'

  account_name:
    sql: '"ACCOUNT_NAME"'

  opportunity_created_date:
    sql: '"OPPORTUNITY_CREATED_DATE"'

  date:
    sql: '"DATE"'

  fiscal_quarter:
    sql: '"FISCAL_QUARTER"'

  fiscal_year:
    sql: '"FISCAL_YEAR"'

  is_closed:
    sql: '"IS_CLOSED"'

  is_won:
    sql: '"IS_WON"'

measures:
  count:
    aggregate_type: count

#The info below was pulled from your dbt repository and is read-only.
dbt:
  name: fct_opportunity
  target_schema: STAGING
  config:
    schema: marts
    materialized: table
  code: |-
    with opp as (
        select * from {{ ref('stg_salesforce__opportunity') }}
    ),
    acct as (
        select * from {{ ref('dim_account') }}
    )
    select
        opp.opportunity_id,
        opp.opportunity_name,
        opp.account_id,
        opp.opportunity_stage_name,
        opp.amount,
        opp.probability,
        opp.opportunity_type,
        acct.account_name,
        opp.opportunity_created_date,
        opp.opportunity_close_date as date,
        opp.fiscal_quarter,
        opp.fiscal_year,
        opp.is_closed,
        opp.is_won
    from opp
    left join acct using (account_id)
  referenced_by: [ fct_dated_conversion_rate ]
