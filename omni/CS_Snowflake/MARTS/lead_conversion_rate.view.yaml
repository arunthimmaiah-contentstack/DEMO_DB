# Reference this view as marts__lead_conversion_rate
schema: MARTS
table_name: LEAD_CONVERSION_RATE

dimensions:
  created_date:
    sql: '"CREATED_DATE"'

  lead_conversion_rate:
    sql: '"LEAD_CONVERSION_RATE"'

measures:
  count:
    aggregate_type: count

#The info below was pulled from your dbt repository and is read-only.
dbt:
  name: lead_conversion_rate
  target_schema: STAGING
  config:
    schema: marts
    materialized: table
  code: |-
    with lead_metrics as (
        select
            created_date,
            count(*) as lead_count,
            count(case when is_converted = true then 1 end) as converted_lead_count
        from _omni_ref_sub_
        group by created_date
    )

    select
        created_date,
        case 
            when lead_count = 0 then null
            else converted_lead_count * 1.0 / lead_count
        end as lead_conversion_rate
    from lead_metrics
