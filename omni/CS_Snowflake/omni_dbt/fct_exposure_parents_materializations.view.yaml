# Reference this view as omni_dbt__fct_exposure_parents_materializations
schema_label: ""
#This description was pulled from dbt.
description: This table shows each direct parent of an exposure that is not
  materialized as a table or incremental.

schema: omni_dbt
table_name: FCT_EXPOSURE_PARENTS_MATERIALIZATIONS

dimensions:
  parent_resource_type:
    sql: '"PARENT_RESOURCE_TYPE"'

  parent_resource_name:
    sql: '"PARENT_RESOURCE_NAME"'

  exposure_name:
    sql: '"EXPOSURE_NAME"'

  parent_model_materialization:
    sql: '"PARENT_MODEL_MATERIALIZATION"'

measures:
  count:
    aggregate_type: count

#The info below was pulled from your dbt repository and is read-only.
dbt:
  name: fct_exposure_parents_materializations
  target_schema: STAGING
  description: This table shows each direct parent of an exposure that is not
    materialized as a table or incremental.
  config:
    materialized: view
  code: |-
    with 

    direct_exposure_relationships as (
        select * from {{ ref('int_all_dag_relationships') }}
        where 
            distance = 1
            and child_resource_type = 'exposure'
            and ((
                    parent_resource_type = 'model'
                    and parent_materialized in ('view', 'ephemeral')
                )
                or (
                    parent_resource_type = 'source'
                )
            )
            -- no test on child_is_excluded because exposures are never excluded
            and not parent_is_excluded
    ),

    final as (

        select 
            parent_resource_type,
            parent as parent_resource_name,
            child as exposure_name,
            parent_materialized as parent_model_materialization

        from direct_exposure_relationships

    )

    select * from final

    {{ filter_exceptions() }}
